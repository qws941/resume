# Cloudflare Workflows 요구사항 정의서

## 프로젝트 개요

| 항목         | 내용                                               |
| ------------ | -------------------------------------------------- |
| **프로젝트** | Job Automation Serverless Workflows                |
| **목적**     | 채용 자동화 프로세스를 Cloudflare Workflows로 전환 |
| **작성일**   | 2026-02-05                                         |
| **상태**     | 구현 완료                                          |

---

## 기능 요구사항 체크리스트

### F1. 채용공고 크롤링 (JobCrawlingWorkflow)

| ID    | 기능               | 설명                                         | 구현 |
| ----- | ------------------ | -------------------------------------------- | ---- |
| F1.1  | 멀티플랫폼 크롤링  | Wanted, LinkedIn, Remember 동시 지원         | ✅   |
| F1.2  | 플랫폼별 독립 실행 | 한 플랫폼 실패 시 다른 플랫폼 영향 없음      | ✅   |
| F1.3  | 자동 재시도        | 실패 시 3회까지 exponential backoff로 재시도 | ✅   |
| F1.4  | Rate Limit 준수    | 플랫폼 간 30초 간격 대기                     | ✅   |
| F1.5  | 세션 검증          | 크롤링 전 각 플랫폼 인증 상태 확인           | ✅   |
| F1.6  | 결과 중복 제거     | 회사명+포지션 기준 deduplication             | ✅   |
| F1.7  | 매칭 스코어 계산   | 선호 기업/스킬 기반 점수 산출                | ✅   |
| F1.8  | D1 저장            | 매칭된 채용공고 데이터베이스 저장            | ✅   |
| F1.9  | Slack 알림         | 크롤링 완료 시 결과 요약 발송                | ✅   |
| F1.10 | Dry-run 모드       | 저장 없이 테스트 실행 지원                   | ✅   |

### F2. 채용 지원서 제출 (ApplicationWorkflow)

| ID    | 기능            | 설명                           | 구현 |
| ----- | --------------- | ------------------------------ | ---- |
| F2.1  | 입력 검증       | 채용공고/이력서 존재 여부 확인 | ✅   |
| F2.2  | 중복 지원 방지  | 이미 지원한 공고 재지원 차단   | ✅   |
| F2.3  | 커버레터 생성   | 제공되지 않은 경우 자동 생성   | ✅   |
| F2.4  | 이력서 포맷팅   | 플랫폼별 형식에 맞게 변환      | ✅   |
| F2.5  | 승인 게이트     | 수동 승인 대기 (최대 24시간)   | ✅   |
| F2.6  | 승인 상태 저장  | KV에 승인/거절 상태 persist    | ✅   |
| F2.7  | 자동 제출 옵션  | 승인 없이 즉시 제출 모드       | ✅   |
| F2.8  | 플랫폼 API 제출 | Wanted API 통한 지원서 제출    | ✅   |
| F2.9  | 지원 기록 저장  | D1에 applications 테이블 저장  | ✅   |
| F2.10 | 성공/실패 알림  | Slack으로 결과 통지            | ✅   |

### F3. 이력서 동기화 (ResumeSyncWorkflow)

| ID    | 기능          | 설명                                     | 구현 |
| ----- | ------------- | ---------------------------------------- | ---- |
| F3.1  | SSoT Export   | 마스터 이력서 데이터 로드                | ✅   |
| F3.2  | 플랫폼 Export | 각 플랫폼 현재 상태 추출                 | ✅   |
| F3.3  | Diff 계산     | 추가/수정/삭제 항목 식별                 | ✅   |
| F3.4  | 섹션별 비교   | careers, educations, skills 등 개별 비교 | ✅   |
| F3.5  | 백업 생성     | 동기화 전 현재 상태 백업 (30일 보관)     | ✅   |
| F3.6  | 플랫폼 Sync   | Wanted API로 변경사항 적용               | ✅   |
| F3.7  | 검증          | 동기화 후 결과 재확인                    | ✅   |
| F3.8  | 히스토리 기록 | D1에 동기화 이력 저장                    | ✅   |
| F3.9  | Dry-run 모드  | 미리보기만 수행 (변경 없음)              | ✅   |
| F3.10 | Rate Limit    | 플랫폼 간 API 호출 간격 준수             | ✅   |

### F4. 일일 리포트 (DailyReportWorkflow)

| ID    | 기능              | 설명                                              | 구현 |
| ----- | ----------------- | ------------------------------------------------- | ---- |
| F4.1  | 지원 통계 집계    | 상태별 (applied, interviewing, offered 등) 카운트 | ✅   |
| F4.2  | 플랫폼별 통계     | 플랫폼별 지원 수 및 성공률                        | ✅   |
| F4.3  | 검색 통계         | 총 검색 수, 평균/최고 매칭 스코어                 | ✅   |
| F4.4  | 트렌드 분석       | 이전 기간 대비 증감 비교                          | ✅   |
| F4.5  | 리포트 포맷팅     | 한글 이모지 포함 가독성 높은 형식                 | ✅   |
| F4.6  | D1 저장           | reports 테이블에 리포트 저장                      | ✅   |
| F4.7  | Slack 발송        | 블록 포맷 메시지로 발송                           | ✅   |
| F4.8  | daily/weekly 지원 | 리포트 타입 선택 가능                             | ✅   |
| F4.9  | 날짜 지정         | 특정 날짜 기준 리포트 생성                        | ✅   |
| F4.10 | 대시보드 링크     | 리포트에 대시보드 URL 포함                        | ✅   |

---

## 비기능 요구사항 체크리스트

### NF1. 인프라 및 배포

| ID    | 요구사항             | 설명                                | 구현       |
| ----- | -------------------- | ----------------------------------- | ---------- |
| NF1.1 | Cloudflare Workflows | 네이티브 Workflows 사용             | ✅         |
| NF1.2 | Worker 이름 정규화   | production/staging 동일 이름        | ✅         |
| NF1.3 | wrangler.toml 설정   | [[workflows]] 바인딩 구성           | ✅         |
| NF1.4 | 클래스 Export        | index.js에서 Workflow 클래스 export | ✅         |
| NF1.5 | 빌드 성공            | wrangler deploy --dry-run 통과      | ✅         |
| NF1.6 | 번들 크기            | 500KB 미만                          | ✅ (204KB) |

### NF2. API 및 통합

| ID    | 요구사항          | 설명                                         | 구현 |
| ----- | ----------------- | -------------------------------------------- | ---- |
| NF2.1 | Workflow 시작 API | POST /api/workflows/{type}                   | ✅   |
| NF2.2 | 상태 조회 API     | GET /api/workflows/{type}/{id}               | ✅   |
| NF2.3 | 승인 API          | POST /api/workflows/application/{id}/approve | ✅   |
| NF2.4 | 거절 API          | POST /api/workflows/application/{id}/reject  | ✅   |
| NF2.5 | Cron 통합         | scheduled()에서 Workflow 트리거              | ✅   |
| NF2.6 | 월-금 크롤링      | 0 0 \* \* 1-5 → JobCrawlingWorkflow          | ✅   |
| NF2.7 | 일일 리포트       | 0 9 \* \* \* → DailyReportWorkflow           | ✅   |

### NF3. 보안

| ID    | 요구사항   | 설명                            | 구현 |
| ----- | ---------- | ------------------------------- | ---- |
| NF3.1 | API 인증   | Workflow API 인증 미들웨어 적용 | ✅   |
| NF3.2 | Rate Limit | API 호출 제한                   | ✅   |
| NF3.3 | CSRF 보호  | 토큰 검증                       | ✅   |
| NF3.4 | 세션 검증  | 플랫폼 세션 유효성 확인         | ✅   |

### NF4. 안정성

| ID    | 요구사항            | 설명                    | 구현 |
| ----- | ------------------- | ----------------------- | ---- |
| NF4.1 | 자동 재시도         | step.do() retry 설정    | ✅   |
| NF4.2 | Exponential Backoff | 재시도 간격 증가        | ✅   |
| NF4.3 | 타임아웃            | step별 타임아웃 설정    | ✅   |
| NF4.4 | 상태 영속성         | Workflow 상태 자동 저장 | ✅   |
| NF4.5 | 에러 로깅           | 실패 시 Slack 알림      | ✅   |

---

## 요약

| 카테고리            | 총 항목 | 완료   | 완료율   |
| ------------------- | ------- | ------ | -------- |
| F1. 채용공고 크롤링 | 10      | 10     | 100%     |
| F2. 지원서 제출     | 10      | 10     | 100%     |
| F3. 이력서 동기화   | 10      | 10     | 100%     |
| F4. 일일 리포트     | 10      | 10     | 100%     |
| NF1. 인프라/배포    | 6       | 6      | 100%     |
| NF2. API/통합       | 7       | 7      | 100%     |
| NF3. 보안           | 4       | 4      | 100%     |
| NF4. 안정성         | 5       | 5      | 100%     |
| **총합**            | **62**  | **62** | **100%** |

---

## 배포 명령어

```bash
# Job Automation Worker
cd typescript/job-automation/workers
npx wrangler deploy --env production

# Portfolio Worker
cd typescript/portfolio-worker
npx wrangler deploy --env production
```
