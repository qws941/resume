<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ¤– AI ìë™í™” ì±„ìš© ì§€ì› ì‹œìŠ¤í…œ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
      <!-- API_CONTRACTS_INJECTION -->
    </script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #333;
        min-height: 100vh;
      }

      .login-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
      }

      .login-card {
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .status-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .status-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .status-card:hover {
        transform: translateY(-5px);
      }

      .status-card h3 {
        font-size: 1.2em;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
      }

      .status-operational {
        background: #10b981;
      }
      .status-degraded {
        background: #f59e0b;
      }
      .status-error {
        background: #ef4444;
      }
      .status-unknown {
        background: #6b7280;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .stat-value {
        font-size: 2.5em;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
        font-size: 0.9em;
      }

      .ai-section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .ai-section h2 {
        margin-bottom: 20px;
        color: #667eea;
      }

      .ai-test-form {
        display: grid;
        gap: 15px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .form-group label {
        font-weight: 500;
        color: #555;
      }

      .form-group input,
      .form-group textarea {
        padding: 12px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
      }

      .btn-secondary {
        background: #f8f9fa;
        color: #666;
        border: 2px solid #e1e5e9;
      }

      .btn-secondary:hover {
        background: #e9ecef;
      }

      .ai-result {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        display: none;
      }

      .ai-result.show {
        display: block;
      }

      .match-score {
        font-size: 2em;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .match-high {
        color: #10b981;
      }
      .match-medium {
        color: #f59e0b;
      }
      .match-low {
        color: #ef4444;
      }

      .automation-section {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .automation-section h2 {
        margin-bottom: 20px;
        color: #667eea;
      }

      .automation-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .control-group label {
        font-weight: 500;
        color: #555;
        font-size: 14px;
      }

      .control-group input,
      .control-group select {
        padding: 10px;
        border: 2px solid #e1e5e9;
        border-radius: 6px;
        font-size: 14px;
      }

      .recent-applications {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .recent-applications h2 {
        margin-bottom: 20px;
        color: #667eea;
      }

      .applications-list {
        display: grid;
        gap: 15px;
      }

      .application-item {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
      }

      .application-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
      }

      .application-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 8px;
      }

      .application-title {
        font-weight: 600;
        color: #333;
      }

      .application-status {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-applied {
        background: #d1ecf1;
        color: #0c5460;
      }
      .status-pending {
        background: #fff3cd;
        color: #856404;
      }
      .status-interview {
        background: #d4edda;
        color: #155724;
      }
      .status-rejected {
        background: #f8d7da;
        color: #721c24;
      }

      .application-meta {
        font-size: 14px;
        color: #666;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
      }

      .alert.show {
        display: block;
      }

      .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-error {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .alert-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }

        .header h1 {
          font-size: 2em;
        }

        .status-grid,
        .stats-grid {
          grid-template-columns: 1fr;
        }

        .automation-controls {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div id="login-overlay" class="login-overlay">
      <div class="login-card">
        <h1>ğŸ” ì ‘ê·¼ ì œí•œ</h1>
        <p style="margin-bottom: 20px; color: #666">ì¸ê°€ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <div
          id="g_id_onload"
          data-client_id="270835336667-1n57053075675546.apps.googleusercontent.com"
          data-callback="handleCredentialResponse"
          data-auto_select="true"
        ></div>
        <div
          class="g_id_signin"
          data-type="standard"
          data-size="large"
          data-theme="outline"
          data-text="sign_in_with"
          data-shape="rectangular"
          data-logo_alignment="left"
        ></div>
      </div>
    </div>

    <div class="container" id="main-content" style="filter: blur(5px); pointer-events: none">
      <div class="header">
        <h1>ğŸ¤– AI ìë™í™” ì±„ìš© ì§€ì› ì‹œìŠ¤í…œ</h1>
        <p>ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ë° ì§€ëŠ¥í˜• ë§¤ì¹­ ëŒ€ì‹œë³´ë“œ</p>
        <div
          id="system-status"
          class="status-indicator status-unknown"
          style="margin: 10px auto"
        ></div>
      </div>

      <div id="alert-container"></div>

      <div class="status-grid">
        <div class="status-card" style="border-left: 4px solid #f59e0b">
          <h3>
            <span class="status-indicator status-operational" id="portfolio-status"></span>
            í¬íŠ¸í´ë¦¬ì˜¤ (Cloudflare)
          </h3>
          <div id="portfolio-stats-text">ë¡œë”© ì¤‘...</div>
          <div style="font-size: 0.8em; margin-top: 5px; color: #666" id="portfolio-details"></div>
        </div>

        <div class="status-card">
          <h3>
            <span class="status-indicator status-unknown" id="ai-status"></span>
            AI ì‹œìŠ¤í…œ
          </h3>
          <div id="ai-status-text">í™•ì¸ ì¤‘...</div>
        </div>

        <div class="status-card">
          <h3>
            <span class="status-indicator status-unknown" id="crawler-status"></span>
            í¬ë¡¤ëŸ¬ ì‹œìŠ¤í…œ
          </h3>
          <div id="crawler-status-text">í™•ì¸ ì¤‘...</div>
        </div>

        <div class="status-card">
          <h3>
            <span class="status-indicator status-unknown" id="db-status"></span>
            ë°ì´í„°ë² ì´ìŠ¤
          </h3>
          <div id="db-status-text">í™•ì¸ ì¤‘...</div>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="total-apps">-</div>
          <div class="stat-label">ì´ ì§€ì›ê±´ìˆ˜</div>
        </div>

        <div class="stat-card">
          <div class="stat-value" id="success-rate">-</div>
          <div class="stat-label">ì„±ê³µë¥  (%)</div>
        </div>

        <div class="stat-card">
          <div class="stat-value" id="ai-matches">-</div>
          <div class="stat-label">AI ë§¤ì¹­</div>
        </div>

        <div class="stat-card">
          <div class="stat-value" id="pending-apps">-</div>
          <div class="stat-label">ëŒ€ê¸°ì¤‘</div>
        </div>
      </div>

      <div class="ai-section">
        <h2>ğŸ§  AI ë§¤ì¹­ í…ŒìŠ¤íŠ¸</h2>
        <form class="ai-test-form" id="ai-test-form">
          <div class="form-group">
            <label for="job-title">ì±„ìš© ê³µê³  ì œëª©</label>
            <input
              type="text"
              id="job-title"
              placeholder="ì˜ˆ: Senior DevSecOps Engineer"
              value="Senior DevSecOps Engineer"
            />
          </div>

          <div class="form-group">
            <label for="company">íšŒì‚¬ëª…</label>
            <input type="text" id="company" placeholder="ì˜ˆ: Tech Company" value="í…Œí¬ íšŒì‚¬" />
          </div>

          <div class="form-group">
            <label for="job-description">ì±„ìš© ê³µê³  ë‚´ìš©</label>
            <textarea id="job-description" placeholder="ì±„ìš© ê³µê³ ì˜ ì£¼ìš” ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...">
DevSecOps ì—”ì§€ë‹ˆì–´ í¬ì§€ì…˜ì…ë‹ˆë‹¤. ë³´ì•ˆê³¼ DevOps ê²½í—˜ì„ ë³´ìœ í•œ ë¶„ì„ ì°¾ìŠµë‹ˆë‹¤. AWS, Kubernetes, CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶• ê²½í—˜ í•„ìˆ˜ì…ë‹ˆë‹¤.</textarea
            >
          </div>

          <button type="submit" class="btn btn-primary">
            <span class="loading" id="ai-loading" style="display: none"></span>
            ğŸ¤– AI ë§¤ì¹­ ë¶„ì„
          </button>
        </form>

        <div class="ai-result" id="ai-result">
          <h3>AI ë¶„ì„ ê²°ê³¼</h3>
          <div class="match-score" id="match-score">-</div>
          <div id="match-details"></div>
        </div>
      </div>

      <div class="automation-section">
        <h2>âš™ï¸ ìë™í™” ì œì–´</h2>
        <div class="automation-controls">
          <div class="control-group">
            <label for="auto-keywords">í‚¤ì›Œë“œ</label>
            <input
              type="text"
              id="auto-keywords"
              value="DevSecOps,ë³´ì•ˆ ì—”ì§€ë‹ˆì–´"
              placeholder="ì‰¼í‘œë¡œ êµ¬ë¶„"
            />
          </div>

          <div class="control-group">
            <label for="auto-max-apps">ìµœëŒ€ ì§€ì› ìˆ˜</label>
            <input type="number" id="auto-max-apps" value="3" min="1" max="10" />
          </div>

          <div class="control-group">
            <label for="auto-platforms">ëŒ€ìƒ í”Œë«í¼</label>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; padding: 5px">
              <label><input type="checkbox" name="platform" value="wanted" checked /> ì›í‹°ë“œ</label>
              <label
                ><input type="checkbox" name="platform" value="saramin" checked /> ì‚¬ëŒì¸</label
              >
              <label
                ><input type="checkbox" name="platform" value="jobkorea" checked /> ì¡ì½”ë¦¬ì•„</label
              >
              <label
                ><input type="checkbox" name="platform" value="linkedin" checked /> ë§í¬ë“œì¸</label
              >
              <label
                ><input type="checkbox" name="platform" value="remember" disabled /> ë¦¬ë©¤ë²„
                (ì¤€ë¹„ì¤‘)</label
              >
            </div>
          </div>

          <div class="control-group">
            <label for="auto-mode">ì‹¤í–‰ ëª¨ë“œ</label>
            <select id="auto-mode">
              <option value="true">ë“œë¼ì´ëŸ° (ì•ˆì „)</option>
              <option value="false">ì‹¤ì œ ì§€ì›</option>
            </select>
          </div>
        </div>

        <div style="display: flex; gap: 10px; flex-wrap: wrap">
          <button class="btn btn-primary" id="run-ai-system">ğŸš€ AI ì‹œìŠ¤í…œ ì‹¤í–‰</button>

          <button class="btn btn-secondary" id="run-basic-system">ğŸ”„ ê¸°ë³¸ ì‹œìŠ¤í…œ ì‹¤í–‰</button>

          <button class="btn btn-secondary" id="refresh-stats">ğŸ“Š í†µê³„ ìƒˆë¡œê³ ì¹¨</button>
        </div>
      </div>

      <div class="automation-section">
        <h2>ğŸ” í”Œë«í¼ ì¸ì¦ ê´€ë¦¬</h2>
        <div
          id="auth-platforms-grid"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
          "
        >
          <!-- Auth cards will be rendered here -->
        </div>

        <div
          id="auth-modal"
          style="
            display: none;
            background: rgba(0, 0, 0, 0.5);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            align-items: center;
            justify-content: center;
          "
        >
          <div
            style="
              background: white;
              padding: 30px;
              border-radius: 15px;
              width: 500px;
              max-width: 90%;
            "
          >
            <h3 id="auth-modal-title">í”Œë«í¼ ì¸ì¦ ì„¤ì •</h3>
            <div class="form-group" style="margin: 15px 0">
              <label for="auth-cookies">Cookie Header String</label>
              <textarea
                id="auth-cookies"
                style="width: 100%; height: 150px; font-family: monospace; font-size: 12px"
              ></textarea>
              <p style="font-size: 11px; color: #666; margin-top: 5px">
                ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(F12) -> Network -> API ìš”ì²­ í´ë¦­ -> Request Headersì˜ Cookie
                ê°’ì„ ë³µì‚¬í•´ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
              </p>
            </div>
            <div class="form-group" style="margin: 15px 0">
              <label for="auth-email">ê³„ì • ì´ë©”ì¼ (ì„ íƒ)</label>
              <input type="email" id="auth-email" placeholder="user@example.com" />
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end">
              <button class="btn btn-secondary" id="close-auth-modal">ì·¨ì†Œ</button>
              <button class="btn btn-primary" id="save-auth">ì €ì¥í•˜ê¸°</button>
            </div>
          </div>
        </div>
      </div>

      <div class="automation-section">
        <h2>ğŸ‘¤ í†µí•© í”„ë¡œí•„ (Sync Status)</h2>
        <div
          id="profile-sync-grid"
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
          "
        >
          <!-- Profile Sync Cards -->
        </div>

        <div style="background: #f8f9fa; border-radius: 8px; padding: 20px">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 15px;
            "
          >
            <h3 style="margin: 0; font-size: 1.1em">ê¸°ë³¸ ì •ë³´ (Unified)</h3>
            <span style="font-size: 0.8em; color: #666" id="profile-last-updated">ì—…ë°ì´íŠ¸: -</span>
          </div>
          <div
            style="display: grid; grid-template-columns: 100px 1fr; gap: 15px; align-items: center"
          >
            <div style="text-align: center">
              <div
                id="profile-avatar"
                style="
                  width: 80px;
                  height: 80px;
                  border-radius: 50%;
                  background: #e1e5e9;
                  margin: 0 auto;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 30px;
                "
              >
                ğŸ‘¤
              </div>
            </div>
            <div>
              <div
                id="profile-name"
                style="font-weight: bold; font-size: 1.2em; margin-bottom: 5px"
              >
                -
              </div>
              <div id="profile-headline" style="color: #555; font-size: 0.9em; margin-bottom: 5px">
                -
              </div>
              <div id="profile-email" style="color: #777; font-size: 0.9em">-</div>
            </div>
          </div>
        </div>
      </div>

      <div class="recent-applications">
        <h2>ğŸ“‹ ìµœê·¼ ì§€ì› í˜„í™©</h2>
        <div class="applications-list" id="applications-list">
          <div style="text-align: center; color: #666; padding: 40px">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </div>
    </div>

    <script>
      /* API_CONTRACTS_INJECTION */

      // ì „ì—­ ìƒíƒœ
      let systemStatus = {};
      let stats = {};
      let applications = [];
      let cfStats = null;

      // Google Auth Handler
      async function handleCredentialResponse(response) {
        try {
          const res = await fetch(API_CONTRACTS.auth.google.path, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ credential: response.credential }),
          });
          const data = await res.json();
          if (data.success) {
            document.getElementById("login-overlay").style.display = "none";
            document.getElementById("main-content").style.filter = "none";
            document.getElementById("main-content").style.pointerEvents =
              "auto";
            init(); // Start loading data
          } else {
            alert("ì¸ì¦ ì‹¤íŒ¨: " + data.error);
          }
        } catch (e) {
          console.error("Auth error:", e);
          alert("ì¸ì¦ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // DOM ìš”ì†Œë“¤
      const aiStatus = document.getElementById("ai-status");
      const aiStatusText = document.getElementById("ai-status-text");
      const crawlerStatus = document.getElementById("crawler-status");
      const crawlerStatusText = document.getElementById("crawler-status-text");
      const dbStatus = document.getElementById("db-status");
      const dbStatusText = document.getElementById("db-status-text");
      const automationStatus = document.getElementById("automation-status");
      const automationStatusText = document.getElementById(
        "automation-status-text",
      );

      // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
      function updateStatusIndicator(element, status) {
        element.className = "status-indicator";
        element.classList.add(`status-${status}`);
      }

      function showAlert(message, type = "info") {
        const alertContainer = document.getElementById("alert-container");
        const alert = document.createElement("div");
        alert.className = `alert alert-${type} show`;
        alert.textContent = message;

        alertContainer.appendChild(alert);

        setTimeout(() => {
          alert.classList.remove("show");
          setTimeout(() => alert.remove(), 300);
        }, 5000);
      }

      function formatDate(dateString) {
        return new Date(dateString).toLocaleDateString("ko-KR");
      }

      function getStatusClass(status) {
        const classes = {
          applied: "status-applied",
          pending: "status-pending",
          interview: "status-interview",
          rejected: "status-rejected",
        };
        return classes[status] || "status-pending";
      }

      function sanitizeHtml(str) {
        if (str == null) return "";
        return String(str).replace(
          /[&<>"']/g,
          (c) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            })[c],
        );
      }

      // API í˜¸ì¶œ í•¨ìˆ˜ë“¤
      async function fetchCFStats() {
        try {
          const response = await fetch(API_CONTRACTS.cf.stats.path);
          if (response.status === 401 || response.status === 403) return; // Auth handled by overlay
          const data = await response.json();
          if (data.stats && data.stats.length > 0) {
            const today = data.stats[data.stats.length - 1].sum;
            document.getElementById("portfolio-stats-text").innerHTML = `
              <strong>${sanitizeHtml(today.requests.toLocaleString())}</strong> ìš”ì²­ /
              <strong>${sanitizeHtml(today.pageViews.toLocaleString())}</strong> ë·°
            `;
            document.getElementById("portfolio-details").textContent =
              `ìµœê·¼ 7ì¼: ${data.stats.reduce((acc, cur) => acc + cur.sum.requests, 0).toLocaleString()} ìš”ì²­`;
          } else {
            document.getElementById("portfolio-stats-text").textContent =
              "ë°ì´í„° ì—†ìŒ";
          }
        } catch (error) {
          console.error("CF Stats fetch failed:", error);
          document.getElementById("portfolio-stats-text").textContent =
            "ì—°ë™ ì‹¤íŒ¨";
        }
      }

      async function fetchStatus() {
        try {
          const response = await fetch(API_CONTRACTS.status.path);
          const data = await response.json();
          systemStatus = data;
          updateStatusDisplay();
        } catch (error) {
          console.error("Status fetch failed:", error);
        }
      }

      async function fetchStats() {
        try {
          const response = await fetch(API_CONTRACTS.stats.path);
          const data = await response.json();
          stats = data;

          document.getElementById("total-apps").textContent =
            data.totalApplications || 0;
          document.getElementById("success-rate").textContent =
            data.successRate || 0;
          document.getElementById("ai-matches").textContent =
            data.aiStats?.aiMatchCount || 0;
          document.getElementById("pending-apps").textContent =
            data.byStatus?.pending || 0;
        } catch (error) {
          console.error("Stats fetch failed:", error);
        }
      }

      async function fetchApplications() {
        try {
          const response = await fetch(`${API_CONTRACTS.applications.list.path}?limit=10`);
          const data = await response.json();
          applications = data.applications || [];

          renderApplications();
        } catch (error) {
          console.error("Applications fetch failed:", error);
        }
      }

      async function fetchAuthStatus() {
        try {
          const response = await fetch(API_CONTRACTS.auth.status.path);
          const data = await response.json();
          if (data.success) {
            renderAuthPlatforms(data.status);
          }
        } catch (error) {
          console.error("Auth status fetch failed:", error);
        }
      }

      function renderAuthPlatforms(authStatuses) {
        const grid = document.getElementById("auth-platforms-grid");
        grid.innerHTML = authStatuses
          .map(
            (status) => `
                <div class="status-card">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <h3 style="margin: 0;">
                            <span class="status-indicator ${status.authenticated ? "status-operational" : "status-error"}"></span>
                            ${sanitizeHtml(status.platform).toUpperCase()}
                        </h3>
                        <div style="font-size: 11px; color: #666;">
                            ${status.lastUpdated ? "ì—…ë°ì´íŠ¸: " + sanitizeHtml(new Date(status.lastUpdated).toLocaleDateString()) : "ì¸ì¦ ì •ë³´ ì—†ìŒ"}
                        </div>
                    </div>
                    <div style="margin: 15px 0; font-size: 14px;">
                        ${status.authenticated ? `âœ… ê³„ì •: ${sanitizeHtml(status.email) || "ì¸ì¦ë¨"}` : "âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤"}
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px;" onclick="openAuthModal('${sanitizeHtml(status.platform)}')">
                            ${status.authenticated ? "ì¿ í‚¤ ê°±ì‹ " : "ì¸ì¦ ì„¤ì •"}
                        </button>
                        ${
                          status.authenticated
                            ? `
                            <button class="btn btn-secondary" style="padding: 8px 12px; font-size: 12px; color: #ef4444; border-color: #fecaca;" onclick="logout('${sanitizeHtml(status.platform)}')">
                                ë¡œê·¸ì•„ì›ƒ
                            </button>
                        `
                            : ""
                        }
                    </div>
                </div>
            `,
          )
          .join("");
      }

      let currentPlatform = "";
      function openAuthModal(platform) {
        currentPlatform = platform;
        document.getElementById("auth-modal-title").textContent =
          `${platform.toUpperCase()} ì¸ì¦ ì„¤ì •`;
        document.getElementById("auth-cookies").value = "";
        document.getElementById("auth-modal").style.display = "flex";
      }

      document.getElementById("close-auth-modal").onclick = () => {
        document.getElementById("auth-modal").style.display = "none";
      };

      document.getElementById("save-auth").onclick = async () => {
        const cookies = document.getElementById("auth-cookies").value;
        const email = document.getElementById("auth-email").value;

        if (!cookies) {
          showAlert("ì¿ í‚¤ ë¬¸ìì—´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", "error");
          return;
        }

        try {
          const response = await fetch(API_CONTRACTS.auth.set.path, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ platform: currentPlatform, cookies, email }),
          });

          const data = await response.json();
          if (data.success) {
            showAlert(
              `${currentPlatform} ì¸ì¦ ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`,
              "success",
            );
            document.getElementById("auth-modal").style.display = "none";
            fetchAuthStatus();
          } else {
            showAlert(`ì €ì¥ ì‹¤íŒ¨: ${data.error}`, "error");
          }
        } catch (error) {
          showAlert("ì¸ì¦ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
        }
      };

      async function logout(platform) {
        if (!confirm(`${platform}ì—ì„œ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

        try {
          // Use contract path pattern: /api/auth/:platform
          const path = API_CONTRACTS.auth.logout.path.replace(":platform", platform);
          const res = await fetch(path, {
            method: "DELETE",
          });
          const data = await res.json();
          if (data.success) {
            showToast(`${platform} cookies cleared`);
            checkAuth();
          } else {
            showToast("Failed to clear cookies", "error");
          }
        } catch (e) {
          console.error("Cookie clear error:", e);
          showToast("Error clearing cookies", "error");
        }
      };
        return (
          badges[source] ||
          `<span style="background:#666; color:white; padding:2px 6px; border-radius:4px; font-size:11px;">${source}</span>`
        );
      }

      function renderApplications() {
        const listElement = document.getElementById("applications-list");

        if (applications.length === 0) {
          listElement.textContent = "";
          const emptyMessage = document.createElement("div");
          emptyMessage.style.textAlign = "center";
          emptyMessage.style.color = "#666";
          emptyMessage.style.padding = "40px";
          emptyMessage.textContent = "ì§€ì› ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.";
          listElement.appendChild(emptyMessage);
          return;
        }

        listElement.innerHTML = applications
          .map(
            (app) => `
                <div class="application-item">
                    <div class="application-header">
                        <div class="application-title">
                            ${getPlatformBadge(sanitizeHtml(app.source))}
                            ${sanitizeHtml(app.position) || "í¬ì§€ì…˜"} @ ${sanitizeHtml(app.company) || "íšŒì‚¬"}
                        </div>
                        <div class="application-status ${getStatusClass(app.status)}">${sanitizeHtml(app.status) || "pending"}</div>
                    </div>
                    <div class="application-meta">
                        ${sanitizeHtml(formatDate(app.createdAt))} â€¢ ë§¤ì¹­: ${sanitizeHtml(Number(app.matchScore) || 0)}%
                        ${app.notes ? `<br><span style="color:#888; font-size:12px;">Memo: ${sanitizeHtml(app.notes)}</span>` : ""}
                    </div>
                </div>
            `,
          )
          .join("");
      }

      // AI ë§¤ì¹­ í…ŒìŠ¤íŠ¸
      document
        .getElementById("ai-test-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();

          const loading = document.getElementById("ai-loading");
          const result = document.getElementById("ai-result");
          const matchScore = document.getElementById("match-score");
          const matchDetails = document.getElementById("match-details");

          loading.style.display = "inline-block";

          try {
            const response = await fetch(API_CONTRACTS.ai.match.path, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                jobTitle: document.getElementById("job-title").value,
                company: document.getElementById("company").value,
                jobDescription:
                  document.getElementById("job-description").value,
              }),
            });

            const data = await response.json();

            if (data.success && data.match) {
              const score = data.match.percentage;
              matchScore.textContent = `${score}%`;
              matchScore.className = "match-score";

              if (score >= 80) matchScore.classList.add("match-high");
              else if (score >= 60) matchScore.classList.add("match-medium");
              else matchScore.classList.add("match-low");

              matchDetails.innerHTML = `
                        <p><strong>ë§¤ì¹­ ìœ í˜•:</strong> ${data.match.type === "ai" ? "ğŸ¤– AI ë§¤ì¹­" : "ğŸ” ê¸°ë³¸ ë§¤ì¹­"}</p>
                        <p><strong>ì‹ ë¢°ë„:</strong> ${sanitizeHtml(data.match.confidence) || "N/A"}</p>
                        <p><strong>í•©ê²© í™•ë¥ :</strong> ${data.match.successProbability ? sanitizeHtml(data.match.successProbability) + "%" : "N/A"}</p>
                        ${data.match.reasoning ? `<p><strong>ë¶„ì„:</strong> ${sanitizeHtml(data.match.reasoning)}</p>` : ""}
                        ${!data.aiEnabled ? '<p style="color: #f59e0b;">âš ï¸ AIê°€ ë¹„í™œì„±í™”ë˜ì–´ ê¸°ë³¸ ë§¤ì¹­ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤.</p>' : ""}
                    `;

              result.classList.add("show");
              showAlert("AI ë§¤ì¹­ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!", "success");
            } else {
              showAlert("AI ë§¤ì¹­ ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", "error");
            }
          } catch (error) {
            console.error("AI test failed:", error);
            showAlert("AI ë§¤ì¹­ í…ŒìŠ¤íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
          } finally {
            loading.style.display = "none";
          }
        });

      // ìë™í™” ì‹¤í–‰
      document
        .getElementById("run-ai-system")
        .addEventListener("click", async () => {
          const keywords = document.getElementById("auto-keywords").value;
          const maxApps = document.getElementById("auto-max-apps").value;
          const dryRun = document.getElementById("auto-mode").value === "true";

          // ì„ íƒëœ í”Œë«í¼ ìˆ˜ì§‘
          const platforms = Array.from(
            document.querySelectorAll('input[name="platform"]:checked'),
          ).map((cb) => cb.value);

          try {
            const response = await fetch(API_CONTRACTS.ai.runSystem.path, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                keywords: keywords.split(",").map((k) => k.trim()),
                maxApplications: parseInt(maxApps),
                dryRun,
                platforms,
              }),
            });

            const data = await response.json();

            if (data.success) {
              showAlert(
                `${dryRun ? "ë“œë¼ì´ëŸ°" : "ì‹¤ì œ ì§€ì›"} AI ì‹œìŠ¤í…œì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! (ëŒ€ìƒ: ${platforms.join(", ")})`,
                "success",
              );
              setTimeout(() => fetchStats(), 2000);
            } else {
              showAlert("ì‹œìŠ¤í…œ ì‹¤í–‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", "error");
            }
          } catch (error) {
            console.error("System run failed:", error);
            showAlert("ì‹œìŠ¤í…œ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", "error");
          }
        });

      document
        .getElementById("run-basic-system")
        .addEventListener("click", () => {
          showAlert("ê¸°ë³¸ ì‹œìŠ¤í…œ ì‹¤í–‰ì€ CLIë¥¼ í†µí•´ ì´ìš©í•´ì£¼ì„¸ìš”.", "info");
        });

      document.getElementById("refresh-stats").addEventListener("click", () => {
        fetchStats();
        fetchApplications();
        showAlert("í†µê³„ê°€ ìƒˆë¡œê³ ì¹¨ë˜ì—ˆìŠµë‹ˆë‹¤.", "info");
      });

      // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
      async function fetchUnifiedProfile() {
        try {
          const response = await fetch(API_CONTRACTS.profile.unified.path);
          const data = await response.json();

          if (data.success) {
            renderProfile(data.profile);
          }
        } catch (error) {
          console.error("Profile fetch failed:", error);
        }
      }

      function renderProfile(profile) {
        // Basic Info
        document.getElementById("profile-name").textContent =
          profile.basic.name || "-";
        document.getElementById("profile-email").textContent =
          profile.basic.email || "-";
        document.getElementById("profile-headline").textContent =
          profile.basic.headline || "-";
        document.getElementById("profile-last-updated").textContent =
          `ì—…ë°ì´íŠ¸: ${new Date(profile.meta.lastUpdated).toLocaleDateString()}`;

        if (profile.basic.avatar) {
          const avatarElement = document.getElementById("profile-avatar");
          avatarElement.textContent = "";
          const avatarImage = document.createElement("img");
          avatarImage.src = profile.basic.avatar;
          avatarImage.alt = "Profile avatar";
          avatarImage.loading = "lazy";
          avatarImage.decoding = "async";
          avatarImage.width = 80;
          avatarImage.height = 80;
          avatarImage.style.width = "100%";
          avatarImage.style.height = "100%";
          avatarImage.style.borderRadius = "50%";
          avatarImage.style.objectFit = "cover";
          avatarElement.appendChild(avatarImage);
        }

        // Sync Status Grid
        const grid = document.getElementById("profile-sync-grid");
        grid.innerHTML = Object.entries(profile.meta.syncStatus)
          .map(([platform, status]) => {
            let statusColor = "#6b7280"; // unknown
            let statusText = "Unknown";

            if (status.status === "synced") {
              statusColor = "#10b981";
              statusText = "ë™ê¸°í™” ì™„ë£Œ";
            } else if (status.status === "auth_required") {
              statusColor = "#ef4444";
              statusText = "ì¸ì¦ í•„ìš”";
            } else if (status.status === "not_implemented") {
              statusColor = "#f59e0b";
              statusText = "ì§€ì› ì˜ˆì •";
            }

            return `
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                            <span style="font-weight:600; text-transform:uppercase;">${sanitizeHtml(platform)}</span>
                            <span style="width:8px; height:8px; border-radius:50%; background:${sanitizeHtml(statusColor)};"></span>
                        </div>
                        <div style="font-size:12px; color:${sanitizeHtml(statusColor)};">${sanitizeHtml(statusText)}</div>
                        <div style="font-size:11px; color:#888; margin-top:3px;">
                            ${status.lastSync ? sanitizeHtml(new Date(status.lastSync).toLocaleDateString()) : "-"}
                        </div>
                    </div>
                `;
          })
          .join("");
      }

      async function init() {
        // ë¨¼ì € ì¸ì¦ ìƒíƒœ í™•ì¸
        try {
          const authRes = await fetch(API_CONTRACTS.auth.status.path);
          const authData = await authRes.json();
          if (!authData.authenticated) {
            // ì¸ì¦ ì•ˆë¨ -> ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ ìœ ì§€
            return;
          }

          // ì¸ì¦ë¨ -> ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ ì œê±°
          document.getElementById("login-overlay").style.display = "none";
          document.getElementById("main-content").style.filter = "none";
          document.getElementById("main-content").style.pointerEvents = "auto";

          await Promise.all([
            fetchStatus(),
            fetchStats(),
            fetchApplications(),
            fetchAuthStatus(),
            fetchUnifiedProfile(),
            fetchCFStats(),
          ]);
        } catch (e) {
          console.error("Init failed:", e);
        }
      }

      setInterval(() => {
        if (document.getElementById("login-overlay").style.display === "none") {
          fetchStatus();
          fetchStats();
          fetchAuthStatus();
          fetchUnifiedProfile();
        }
      }, 30000);

      // ì´ˆê¸°í™”
      init();
    </script>
  </body>
</html>
