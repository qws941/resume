# =============================================================================
# BAZEL CONFIGURATION
# =============================================================================
# Google3-style monorepo build configuration

# =============================================================================
# COMMON SETTINGS
# =============================================================================
common --enable_platform_specific_config

# =============================================================================
# BUILD SETTINGS
# =============================================================================
build --jobs=auto
build --verbose_failures
build --show_timestamps

# Reproducible builds
build --incompatible_strict_action_env
build --action_env=PATH
build --action_env=HOME

# =============================================================================
# TEST SETTINGS
# =============================================================================
test --test_output=errors
test --test_summary=terse
test --test_verbose_timeout_warnings

# =============================================================================
# CI CONFIGURATION
# =============================================================================
build:ci --disk_cache=.bazel-cache
build:ci --repository_cache=.bazel-cache/repos
build:ci --color=no
build:ci --curses=no
build:ci --show_progress_rate_limit=10
build:ci --loading_phase_threads=1

# Faster CI builds (local execution)
build:ci --spawn_strategy=local
build:ci --strategy=Genrule=local

# =============================================================================
# RELEASE CONFIGURATION
# =============================================================================
build:release --compilation_mode=opt
build:release --define=release=true

# =============================================================================
# QUERY CONFIGURATION
# =============================================================================
query --output=label
query --keep_going

# =============================================================================
# LOCAL DEVELOPMENT
# =============================================================================
build:local --disk_cache=~/.cache/bazel
build:local --color=yes
build:local --curses=yes

# =============================================================================
# REMOTE CACHE (BuildBuddy)
# =============================================================================
# BuildBuddy community tier remote cache for CI builds.
# Local builds use disk cache by default (see build:local).
build:remote-cache --remote_cache=grpcs://remote.buildbuddy.io
build:remote-cache --remote_timeout=3600
build:remote-cache --experimental_remote_cache_compression
build:remote-cache --remote_upload_local_results=true

# Authenticated remote cache (set BUILDBUDDY_API_KEY in CI secrets)
# build:remote-cache --remote_header=x-buildbuddy-api-key=${BUILDBUDDY_API_KEY}

# Try importing local overrides
try-import %workspace%/.bazelrc.local
